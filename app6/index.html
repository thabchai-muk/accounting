<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (Ultimate Final)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .num-input, input.num-fmt { text-align: right; font-variant-numeric: tabular-nums; }
        textarea { resize: vertical; }
        .tab-btn { cursor: pointer; transition: all 0.2s; }
        .tab-active { border-bottom: 3px solid #2563eb; color: #1e40af; font-weight: bold; background-color: #eff6ff; }
        .tab-inactive { color: #6b7280; background-color: white; }
        .tab-inactive:hover { color: #374151; background-color: #f9fafb; }
        .modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 800px; border-radius: 8px; }
        
        @media print {
            @page { size: A4; margin: 10mm; }
            body { background-color: white; -webkit-print-color-adjust: exact; font-size: 10pt; }
            .no-print { display: none !important; }
            .shadow-lg { box-shadow: none; border: none; }
            .break-before { page-break-before: always; }
            input, select, textarea { border: none !important; background: transparent !important; padding: 0; margin: 0; width: 100%; -webkit-appearance: none; }
            #tab-content-tb { display: none !important; }
            body.print-fs #tab-content-fs { display: block !important; }
            body.print-fs #tab-content-notes { display: block !important; }
            body.print-fs #tab-content-tax { display: block !important; }
            body.print-change #tab-content-changes { display: block !important; }
            body.print-dashboard #tab-content-dashboard { display: block !important; }
            .w-col-item { width: 50% !important; } .w-col-note { width: 10% !important; text-align: center; } .w-col-amt { width: 20% !important; text-align: right; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-8 text-gray-800">

    <div id="loginModal" class="modal" style="display: block;">
        <div class="modal-content relative max-w-md bg-white rounded-lg shadow-xl mt-20">
            <h2 class="text-xl font-bold mb-6 text-center text-blue-800">üîê ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <div class="space-y-4 px-4 pb-4">
                <div><label class="block text-sm font-bold mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label><input type="email" id="auth-email" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500"></div>
                <div><label class="block text-sm font-bold mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label><input type="password" id="auth-password" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500"></div>
                <div class="flex gap-3 pt-2">
                    <button onclick="emailLogin()" class="flex-1 bg-blue-600 text-white p-2 rounded hover:bg-blue-700 font-bold shadow">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                <p id="auth-msg" class="text-center text-red-500 text-sm mt-2 min-h-[20px]"></p>
                <div class="text-xs text-gray-400 text-center mt-2 border-t pt-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (Mfins Pro)</div>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content relative">
            <span onclick="closeSettingsModal()" class="absolute top-2 right-4 text-2xl cursor-pointer text-gray-500 hover:text-red-500">&times;</span>
            <h2 class="text-xl font-bold mb-4 text-blue-800">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h2>
            <div class="overflow-y-auto max-h-[400px] border rounded mb-4"><table class="w-full text-sm text-left"><thead class="bg-gray-100 sticky top-0"><tr><th class="p-2 border">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th><th class="p-2 border">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏ö</th><th class="p-2 border text-center w-16">‡∏•‡∏ö</th></tr></thead><tbody id="mapping-settings-body"></tbody></table></div>
            <div class="flex gap-2 mb-6"><input type="text" id="new-map-label" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏´‡∏°‡πà..." class="border p-2 rounded flex-grow text-sm"><select id="new-map-group" class="border p-2 rounded text-sm w-1/3"><option value="asset-cur">‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô</option><option value="asset-non">‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô</option><option value="liab-cur">‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô</option><option value="liab-non">‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô</option><option value="eq">‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô</option><option value="rev">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</option><option value="exp">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</option><option value="fin">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</option><option value="tax">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏µ</option></select><button onclick="addNewMapping()" class="bg-green-500 text-white px-4 py-2 rounded text-sm hover:bg-green-600">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button></div>
            <div class="flex justify-between pt-4 border-t"><button onclick="resetMappingsToDefault()" class="text-red-500 text-sm hover:underline">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</button><button onclick="saveMappingsAndClose()" class="px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î</button></div>
        </div>
    </div>

    <datalist id="std-accounts"><option value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î"><option value="‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏≠‡∏∑‡πà‡∏ô"><option value="‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠"><option value="‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏™‡∏∏‡∏ó‡∏ò‡∏¥)"><option value="‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏≠‡∏∑‡πà‡∏ô"><option value="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£"><option value="‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ç‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£"><option value="‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢"><option value="‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£"><option value="‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢"></datalist>
    <datalist id="tax-add-list"><option value="‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î (0.3% ‡∏´‡∏£‡∏∑‡∏≠ 10 ‡∏•‡∏ö.)"><option value="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏´‡πâ‡∏≤‡∏° (‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à/‡∏ö‡∏¥‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î)"><option value="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß/‡πÄ‡∏™‡∏ô‡πà‡∏´‡∏≤"><option value="‡∏†‡∏≤‡∏©‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ô‡∏¥‡∏ï‡∏¥‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•"><option value="‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏±‡∏ö/‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏ç‡∏≤"><option value="‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç (‡πÄ‡∏Å‡∏¥‡∏ô 2,000 ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏ô)"><option value="‡∏ú‡∏•‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏Å‡πà‡∏≤ (‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏õ‡∏µ)"><option value="‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô)"><option value="‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏ô‡∏±‡πà‡∏á (‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô 36,000/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)"><option value="‡∏ú‡∏•‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô"></datalist>
    <datalist id="tax-deduct-list"><option value="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤/‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏° (2 ‡πÄ‡∏ó‡πà‡∏≤)"><option value="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ (2 ‡πÄ‡∏ó‡πà‡∏≤)"><option value="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (2 ‡πÄ‡∏ó‡πà‡∏≤)"><option value="‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏Å‡∏∏‡∏®‡∏• (2 ‡πÄ‡∏ó‡πà‡∏≤)"><option value="‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (1 ‡πÄ‡∏ó‡πà‡∏≤)"><option value="‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏ô‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô"></datalist>

    <div class="max-w-6xl mx-auto bg-white p-8 shadow-lg rounded-lg border border-gray-200 hidden" id="main-container">
        <div class="text-center mb-6 relative">
            <h1 class="text-2xl font-bold mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h1>
            <p class="text-gray-600">‡∏Å‡∏£‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ (DBD)</p>
            <div class="flex justify-center items-center gap-4 mt-4 bg-yellow-50 p-2 rounded-lg border border-yellow-200 w-fit mx-auto no-print">
                <span class="font-bold text-gray-700 text-sm">üìÖ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:</span>
                <div class="flex items-center gap-2"><label class="text-xs">‡∏á‡∏ß‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</label><input type="text" id="year-cur-input" value="2567" class="border rounded px-2 py-1 w-20 text-center font-bold text-blue-700 text-sm" oninput="updateYears(); debounceSave();"></div>
                <div class="flex items-center gap-2"><label class="text-xs">‡∏á‡∏ß‡∏î‡∏Å‡πà‡∏≠‡∏ô:</label><input type="text" id="year-prev-input" value="2566" class="border rounded px-2 py-1 w-20 text-center font-bold text-gray-600 text-sm" oninput="updateYears(); debounceSave();"></div>
            </div>
            <div class="absolute top-0 right-0 no-print flex flex-col items-end gap-1">
                <div class="flex items-center space-x-1 mb-2 bg-blue-50 p-1 rounded border border-blue-100">
                    <span id="userEmailDisplay" class="text-xs font-bold text-blue-800 mr-2 hidden"></span>
                    <button id="btnLogout" onclick="logout()" class="hidden bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm shadow">üö™ ‡∏≠‡∏≠‡∏Å</button>
                </div>
                <div class="flex space-x-1 mb-1">
                    <button onclick="openSettingsModal()" class="bg-gray-700 hover:bg-gray-800 text-white px-3 py-1 rounded text-sm shadow">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                    <button onclick="saveBackupFile()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded text-sm shadow">üíæ Backup</button>
                    <button onclick="document.getElementById('loadBackupInput').click()" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm shadow">üìÇ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå</button>
                    <input type="file" id="loadBackupInput" accept=".json" class="hidden" onchange="loadBackupFile(this)">
                </div>
                <div class="flex space-x-1">
                    <button onclick="hardReset()" class="bg-red-800 hover:bg-red-900 text-white px-3 py-1 rounded text-sm font-bold" title="‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î">‚ö†Ô∏è ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö</button>
                    <button onclick="clearForm()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button onclick="exportReportToExcel()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm flex items-center">Excel</button>
                    <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">PDF</button>
                </div>
                <div id="auto-save-status" class="text-xs text-green-600 font-bold mt-1 opacity-0 transition-opacity">‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß</div>
            </div>
        </div>

        <div class="mt-4 grid grid-cols-2 gap-4 text-left bg-gray-50 p-4 rounded border border-gray-200 mb-6">
            <div><label class="block text-sm font-bold">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</label><input type="text" id="company-name" class="w-full border-b border-gray-300 focus:outline-none focus:border-blue-500 bg-transparent font-bold text-lg" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£..." oninput="debounceSave()"></div>
            <div><label class="block text-sm font-bold">‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô:</label><input type="text" id="company-id" class="w-full border-b border-gray-300 focus:outline-none focus:border-blue-500 bg-transparent" placeholder="0-0000-00000-00-0" oninput="debounceSave()"></div>
            <div class="col-span-2 grid grid-cols-2 gap-4">
                <div><label class="block text-sm font-bold">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label><input type="text" id="closing-date" class="w-full border-b border-gray-300 focus:outline-none focus:border-blue-500 bg-transparent" placeholder="31 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2567" oninput="debounceSave()"></div>
                <div><label class="block text-sm font-bold text-blue-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô‡∏™‡∏≤‡∏°‡∏±‡∏ç (‡∏´‡∏∏‡πâ‡∏ô):</label><input type="text" id="share-count" class="w-full border-b border-blue-300 focus:outline-none focus:border-blue-500 bg-transparent num-input" placeholder="10,000" oninput="fmtInput(this);calculate()"></div>
            </div>
        </div>

        <div class="flex border-b border-gray-200 mb-6 no-print overflow-x-auto text-sm md:text-base">
            <button onclick="switchTab('tb')" id="tab-btn-tb" class="tab-btn flex-1 py-3 px-2 text-center tab-active transition whitespace-nowrap">1. ‡∏á‡∏ö‡∏ó‡∏î‡∏•‡∏≠‡∏á</button>
            <button onclick="switchTab('fs')" id="tab-btn-fs" class="tab-btn flex-1 py-3 px-2 text-center tab-inactive transition whitespace-nowrap">2. ‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</button>
            <button onclick="switchTab('notes')" id="tab-btn-notes" class="tab-btn flex-1 py-3 px-2 text-center tab-inactive transition whitespace-nowrap">3. ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Ø</button>
            <button onclick="switchTab('tax')" id="tab-btn-tax" class="tab-btn flex-1 py-3 px-2 text-center tab-inactive transition whitespace-nowrap text-green-700 bg-green-50">4. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏©‡∏µ</button>
            <button onclick="switchTab('dashboard')" id="tab-btn-dashboard" class="tab-btn flex-1 py-3 px-2 text-center tab-inactive transition whitespace-nowrap text-purple-700 bg-purple-50 font-bold">5. ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</button>
            <button onclick="switchTab('changes')" id="tab-btn-changes" class="tab-btn flex-1 py-3 px-2 text-center tab-inactive transition whitespace-nowrap text-indigo-700 bg-indigo-50 font-bold">6. ‡∏á‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ø</button>
        </div>

        <div id="tab-content-tb">
            <div class="bg-blue-50 border border-blue-200 p-4 rounded mb-4">
                <h3 class="font-bold text-blue-800 mb-2">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏á‡∏ö‡∏ó‡∏î‡∏•‡∏≠‡∏á:</h3>
                <div class="flex flex-wrap items-end gap-3 bg-white p-3 rounded border border-blue-100">
                    <div><label class="block text-xs font-bold text-red-600 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏†‡∏≤‡∏©‡∏≤ (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!)</label><select id="encodingSelect" class="border border-red-300 rounded px-2 py-1.5 text-sm bg-red-50 font-bold text-blue-800"><option value="TIS-620" selected>Thai (TIS-620) - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Express</option><option value="UTF-8">UTF-8 - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option></select></div>
                    <button onclick="document.getElementById('fileInput').click()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1.5 rounded text-sm shadow">üì• ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel/CSV</button>
                    <input type="file" id="fileInput" accept=".csv, .xlsx, .xls" class="hidden" onchange="importFile(this)">
                    <button onclick="downloadTemplate()" class="ml-auto bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-1.5 rounded text-sm border">üìÑ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
                </div>
            </div>
            <table class="w-full text-sm border-collapse shadow-sm"><thead><tr class="bg-gray-700 text-white"><th class="p-3 text-left w-1/3">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</th><th class="p-3 text-left w-1/4">‡∏´‡∏°‡∏ß‡∏î (Mapping)</th><th class="p-3 text-right w-1/6 header-year-cur">CY</th><th class="p-3 text-right w-1/6 header-year-prev">PY</th><th class="p-3 text-center w-10">‡∏•‡∏ö</th></tr></thead><tbody id="tb-body"></tbody></table>
            <div class="mt-4"><button onclick="addTBRow(); debounceSave();" class="bg-green-500 text-white px-4 py-2 rounded shadow text-sm">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button></div>
        </div>

        <div id="tab-content-fs" class="hidden">
            <div class="bg-yellow-50 border border-yellow-200 p-3 rounded mb-4 no-print flex justify-between">
                <div class="text-sm text-yellow-800"><strong>üí° ‡∏ó‡∏£‡∏¥‡∏Ñ:</strong> ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏á‡∏ö‡∏î‡∏∏‡∏•‡πÅ‡∏•‡πâ‡∏ß</div>
                <div class="flex items-center gap-2"><select id="fs-encoding" class="border border-yellow-400 rounded px-2 py-1 text-xs bg-white text-yellow-800 font-bold"><option value="TIS-620" selected>Thai (TIS-620)</option><option value="UTF-8">UTF-8</option></select><button onclick="document.getElementById('fsUpdateInput').click()" class="bg-yellow-600 text-white px-3 py-1.5 rounded text-sm shadow">üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</button><input type="file" id="fsUpdateInput" class="hidden" onchange="importFSUpdate(this)"></div>
            </div>
            <div class="text-right text-sm text-gray-500 mb-2">‡∏´‡∏ô‡πà‡∏ß‡∏¢: ‡∏ö‡∏≤‡∏ó</div>
            <div id="fs-print-container">
            <h2 class="text-xl font-bold border-l-4 border-blue-600 pl-3 mb-4 bg-blue-50 py-2">‡∏á‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ê‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h2>
            <table class="w-full text-sm border-collapse mb-8 table-fixed" id="bs-table">
                <thead><tr class="bg-gray-200 text-gray-700 border-t border-b"><th class="p-3 text-left w-col-item">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th class="p-3 text-center w-col-note text-xs">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th><th class="p-3 text-right w-col-amt header-year-cur">CY</th><th class="p-3 text-right w-col-amt header-year-prev">PY</th><th class="p-3 text-center w-8 no-print"></th></tr></thead>
                <tbody id="balance-sheet-body">
                    <tr><td colspan="5" class="p-2 font-bold text-blue-800 bg-gray-50">‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</td></tr>
                    <tr><td colspan="5" class="p-2 pl-6 font-semibold text-gray-600">‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô</td></tr><tbody id="group-asset-cur"></tbody><tr><td colspan="5" class="no-print p-1 pl-10"><button onclick="addFSRow('group-asset-cur', 'asset-cur');saveStateToLocal();" class="text-blue-500 text-xs hover:underline">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></td></tr><tr class="bg-yellow-50 font-bold"><td class="p-2 pl-6">‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô</td><td></td><td class="p-2 text-right" id="total-asset-cur-cy">0.00</td><td class="p-2 text-right" id="total-asset-cur-py">0.00</td><td></td></tr>
                    <tbody id="group-asset-non"></tbody><tr><td colspan="5" class="no-print p-1 pl-10"><button onclick="addFSRow('group-asset-non', 'asset-non');saveStateToLocal();" class="text-blue-500 text-xs hover:underline">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></td></tr><tr class="bg-yellow-50 font-bold"><td class="p-2 pl-6">‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô</td><td></td><td class="p-2 text-right" id="total-asset-non-cy">0.00</td><td class="p-2 text-right" id="total-asset-non-py">0.00</td><td></td></tr><tr class="bg-blue-100 font-bold border-t-2"><td class="p-3 text-blue-900">‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</td><td></td><td class="p-3 text-right text-lg" id="grand-total-asset-cy">0.00</td><td class="p-3 text-right text-lg" id="grand-total-asset-py">0.00</td><td></td></tr>
                    <tr><td colspan="5" class="p-4"></td></tr>
                    <tr><td colspan="5" class="p-2 font-bold text-red-800 bg-gray-50">‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô</td></tr>
                    <tbody id="group-liab-cur"></tbody><tr><td colspan="5" class="no-print p-1 pl-10"><button onclick="addFSRow('group-liab-cur', 'liab-cur');saveStateToLocal();" class="text-blue-500 text-xs hover:underline">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></td></tr><tr class="bg-yellow-50 font-bold"><td class="p-2 pl-6">‡∏£‡∏ß‡∏°‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô</td><td></td><td class="p-2 text-right" id="total-liab-cur-cy">0.00</td><td class="p-2 text-right" id="total-liab-cur-py">0.00</td><td></td></tr>
                    <tbody id="group-liab-non"></tbody><tr><td colspan="5" class="no-print p-1 pl-10"><button onclick="addFSRow('group-liab-non', 'liab-non');saveStateToLocal();" class="text-blue-500 text-xs hover:underline">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></td></tr><tr class="bg-yellow-50 font-bold"><td class="p-2 pl-6">‡∏£‡∏ß‡∏°‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô</td><td></td><td class="p-2 text-right" id="total-liab-non-cy">0.00</td><td class="p-2 text-right" id="total-liab-non-py">0.00</td><td></td></tr><tr class="bg-red-50 font-bold border-t"><td class="p-2 pl-6 text-red-900">‡∏£‡∏ß‡∏°‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô</td><td></td><td class="p-2 text-right" id="grand-total-liab-cy">0.00</td><td class="p-2 text-right" id="grand-total-liab-py">0.00</td><td></td></tr>
                    <tbody id="group-eq"></tbody>
                    <tr class="text-blue-600 bg-blue-50"><td class="p-1 pl-10 border-b border-gray-100">‡∏ö‡∏ß‡∏Å: ‡∏Å‡∏≥‡πÑ‡∏£(‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô)‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏á‡∏ß‡∏î</td><td class="p-1 text-center">-</td><td class="p-1 text-right font-bold" id="bs-auto-profit-cy">0.00</td><td class="p-1 text-right font-bold" id="bs-auto-profit-py">0.00</td><td></td></tr>
                    <tr><td colspan="5" class="no-print p-1 pl-10"><button onclick="addFSRow('group-eq', 'eq');saveStateToLocal();" class="text-blue-500 text-xs hover:underline">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></td></tr><tr class="bg-yellow-50 font-bold"><td class="p-2 pl-6">‡∏£‡∏ß‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô</td><td></td><td class="p-2 text-right" id="total-eq-cy">0.00</td><td class="p-2 text-right" id="total-eq-py">0.00</td><td></td></tr><tr class="bg-blue-100 font-bold border-t-2"><td class="p-3 text-blue-900">‡∏£‡∏ß‡∏°‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô</td><td></td><td class="p-3 text-right text-lg" id="grand-total-le-cy">0.00</td><td class="p-3 text-right text-lg" id="grand-total-le-py">0.00</td><td></td></tr>
                    <tr id="balance-check-row" class="hidden no-print text-white text-center font-bold"><td colspan="5" class="p-2 rounded bg-green-500" id="balance-msg"></td></tr>
                </tbody>
            </table>
            <div class="break-before"></div>
            <h2 class="text-xl font-bold border-l-4 border-green-600 pl-3 mb-4 bg-green-50 py-2">‡∏á‡∏ö‡∏Å‡∏≥‡πÑ‡∏£‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</h2>
            <table class="w-full text-sm border-collapse table-fixed" id="pl-table">
                <thead><tr class="bg-gray-200 text-gray-700 border-t border-b"><th class="p-3 text-left w-col-item">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th class="p-3 text-center w-col-note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th><th class="p-3 text-right w-col-amt header-year-cur">CY</th><th class="p-3 text-right w-col-amt header-year-prev">PY</th><th class="p-3 text-center w-8 no-print"></th></tr></thead>
                <tbody>
                    <tr><td colspan="5" class="p-2 font-bold text-green-800">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</td></tr><tbody id="group-rev"></tbody><tr><td colspan="5" class="no-print p-1 pl-10"><button onclick="addFSRow('group-rev', 'rev');saveStateToLocal();" class="text-blue-500 text-xs hover:underline">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></td></tr><tr class="bg-yellow-50 font-bold"><td class="p-2 pl-6">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</td><td></td><td class="p-2 text-right" id="total-rev-cy">0.00</td><td class="p-2 text-right" id="total-rev-py">0.00</td><td></td></tr>
                    <tr><td colspan="5" class="p-2 font-bold text-red-800">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</td></tr><tbody id="group-exp"></tbody><tr><td colspan="5" class="no-print p-1 pl-10"><button onclick="addFSRow('group-exp', 'exp');saveStateToLocal();" class="text-blue-500 text-xs hover:underline">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></td></tr><tr class="bg-yellow-50 font-bold"><td class="p-2 pl-6">‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</td><td></td><td class="p-2 text-right" id="total-exp-cy">0.00</td><td class="p-2 text-right" id="total-exp-py">0.00</td><td></td></tr>
                    <tr class="font-bold border-t"><td class="p-2 pl-6">‡∏Å‡∏≥‡πÑ‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</td><td></td><td class="p-2 text-right" id="ebit-cy">0.00</td><td class="p-2 text-right" id="ebit-py">0.00</td><td></td></tr>
                    <tbody id="group-fin"></tbody><tr><td colspan="5" class="no-print p-1 pl-10"><button onclick="addFSRow('group-fin', 'fin');saveStateToLocal();" class="text-blue-500 text-xs hover:underline">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></td></tr><tr class="font-bold"><td class="p-2 pl-6">‡∏Å‡∏≥‡πÑ‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</td><td></td><td class="p-2 text-right" id="ebt-cy">0.00</td><td class="p-2 text-right" id="ebt-py">0.00</td><td></td></tr>
                    <tbody id="group-tax"></tbody><tr><td colspan="5" class="no-print p-1 pl-10"><button onclick="addFSRow('group-tax', 'tax');saveStateToLocal();" class="text-blue-500 text-xs hover:underline">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></td></tr>
                    <tr class="bg-green-100 font-bold border-t-2"><td class="p-3 text-green-900">‡∏Å‡∏≥‡πÑ‡∏£(‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô) ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</td><td></td><td class="p-3 text-right text-lg" id="net-profit-cy">0.00</td><td class="p-3 text-right text-lg" id="net-profit-py">0.00</td><td></td></tr>
                    <tr class="border-t border-gray-400"><td class="p-3 text-blue-800 font-bold pl-6">‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡∏ö‡∏≤‡∏ó)</td><td></td><td class="p-3 text-right font-bold text-blue-800" id="eps-cy">0.00</td><td class="p-3 text-right font-bold text-blue-800" id="eps-py">0.00</td><td></td></tr>
                </tbody>
            </table>
            </div>
        </div>

        <div id="tab-content-notes" class="hidden">
            <div class="space-y-4 text-sm"><div class="bg-white p-4 border rounded"><h3 class="font-bold mb-2">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3><textarea id="note-1-text" class="w-full p-2 border rounded h-20" oninput="debounceSave()"></textarea></div><div class="bg-white p-4 border rounded"><h3 class="font-bold mb-2">2. ‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h3><textarea id="note-2-text" class="w-full p-2 border rounded h-24" oninput="debounceSave()"></textarea></div><div id="dynamic-notes-container" class="space-y-4"></div></div>
        </div>

        <div id="tab-content-tax" class="hidden">
            <div class="bg-white p-6 border rounded shadow-sm"><div class="mb-4 p-4 bg-yellow-50 rounded"><label class="mr-4"><input type="radio" name="tax-type" value="sme" checked onchange="calculateTax();debounceSave()"> SME</label><label><input type="radio" name="tax-type" value="general" onchange="calculateTax();debounceSave()"> ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ 20%</label></div><table class="w-full text-sm border-collapse" id="tax-table"><tbody><tr><td class="p-3 font-bold">1. ‡∏Å‡∏≥‡πÑ‡∏£‡∏ó‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</td><td class="p-3 text-right font-bold" id="tax-accounting-profit">0.00</td></tr><tr class="bg-gray-50"><td colspan="2" class="p-2 text-green-800 font-bold">‡∏ö‡∏ß‡∏Å ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏´‡πâ‡∏≤‡∏°</td></tr><tbody id="tax-add-body"></tbody><tr><td colspan="2"><button onclick="addTaxRow('tax-add-body','tax-add-item')" class="text-blue-500 text-xs pl-4">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button></td></tr><tr class="bg-gray-50"><td colspan="2" class="p-2 text-red-800 font-bold">‡∏´‡∏±‡∏Å ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏±‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°</td></tr><tbody id="tax-deduct-body"></tbody><tr><td colspan="2"><button onclick="addTaxRow('tax-deduct-body','tax-deduct-item')" class="text-blue-500 text-xs pl-4">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button></td></tr><tr class="font-bold border-t"><td class="p-3">2. ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏ó‡∏≤‡∏á‡∏†‡∏≤‡∏©‡∏µ</td><td class="p-3 text-right" id="tax-net-profit">0.00</td></tr><tbody id="tax-calc-steps" class="text-gray-600 bg-gray-50"></tbody><tr class="font-bold border-t-2 bg-green-100"><td class="p-3 text-right">‡∏†‡∏≤‡∏©‡∏µ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</td><td class="p-3 text-right text-lg" id="tax-payable-total">0.00</td></tr></tbody></table><div class="mt-4 text-center no-print"><button onclick="applyTaxToFS()" class="bg-green-600 text-white px-4 py-2 rounded">‚úÖ ‡πÉ‡∏ä‡πâ‡∏¢‡∏≠‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏á‡∏ö</button></div></div>
        </div>

        <div id="tab-content-dashboard" class="hidden">
             <div class="break-before pt-4"><div class="flex justify-between mb-6 border-b pb-4"><div><h2 class="text-2xl font-bold">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</h2><p class="text-gray-500 text-sm">‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏á‡∏ß‡∏î <span class="header-year-cur"></span> vs <span class="header-year-prev"></span></p></div><div class="text-xs text-gray-400">Printed: <span id="print-date"></span></div></div><div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"><div class="bg-white p-4 border-l-4 border-blue-500 shadow-sm"><div class="text-gray-500 text-xs">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</div><div class="text-xl font-bold" id="dash-rev">0.00</div></div><div class="bg-white p-4 border-l-4 border-green-500 shadow-sm"><div class="text-gray-500 text-xs">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</div><div class="text-xl font-bold" id="dash-profit">0.00</div></div><div class="bg-white p-4 border-l-4 border-purple-500 shadow-sm"><div class="text-gray-500 text-xs">Net Margin</div><div class="text-xl font-bold" id="dash-margin">0%</div></div><div class="bg-white p-4 border-l-4 border-yellow-500 shadow-sm"><div class="text-gray-500 text-xs">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</div><div class="text-xl font-bold" id="dash-cash">0.00</div></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"><div class="bg-white p-4 border rounded"><h3 class="font-bold text-center mb-2">Performance</h3><div class="h-64"><canvas id="barChart"></canvas></div></div><div class="bg-white p-4 border rounded"><h3 class="font-bold text-center mb-2">Cost Structure</h3><div class="h-64 flex justify-center"><canvas id="pieChart"></canvas></div></div></div><div class="bg-white border rounded"><table class="w-full text-sm"><thead class="bg-gray-100"><tr><th class="p-3 text-left">Key Ratios</th><th class="p-3 text-right">CY</th><th class="p-3 text-right">PY</th><th class="p-3 text-center">Status</th></tr></thead><tbody class="divide-y"><tr><td class="p-3">Current Ratio</td><td class="p-3 text-right" id="ratio-curr-cy">-</td><td class="p-3 text-right" id="ratio-curr-py">-</td><td class="p-3 text-center" id="ratio-curr-stat"></td></tr><tr><td class="p-3">D/E Ratio</td><td class="p-3 text-right" id="ratio-de-cy">-</td><td class="p-3 text-right" id="ratio-de-py">-</td><td class="p-3 text-center" id="ratio-de-stat"></td></tr><tr><td class="p-3">ROE</td><td class="p-3 text-right" id="ratio-roe-cy">-</td><td class="p-3 text-right" id="ratio-roe-py">-</td><td class="p-3 text-center" id="ratio-roe-stat"></td></tr></tbody></table></div></div>
        </div>

        <div id="tab-content-changes" class="hidden">
            <div class="break-before pt-4">
                <h2 class="text-xl font-bold border-l-4 border-indigo-600 pl-3 mb-4 bg-indigo-50 py-2">‡∏á‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô</h2>
                <div class="overflow-x-auto bg-white rounded border">
                    <table class="w-full text-sm border-collapse" id="changes-table">
                        <thead class="bg-gray-200">
                            <tr><th class="p-3 border text-left">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th class="p-3 border text-right">‡∏ó‡∏∏‡∏ô‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô<br>‡πÅ‡∏•‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</th><th class="p-3 border text-right">‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô(‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤)<br>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏´‡∏∏‡πâ‡∏ô</th><th class="p-3 border text-right">‡∏™‡∏≥‡∏£‡∏≠‡∏á<br>‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢</th><th class="p-3 border text-right">‡∏Å‡∏≥‡πÑ‡∏£(‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô)<br>‡∏™‡∏∞‡∏™‡∏°</th><th class="p-3 border text-right bg-gray-300">‡∏£‡∏ß‡∏°</th></tr>
                        </thead>
                        <tbody id="changes-body"></tbody>
                    </table>
                </div>
                <div class="mt-4 p-4 bg-yellow-50 text-sm border border-yellow-200 rounded">
                    <strong>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏¢‡∏≠‡∏î‡∏ï‡πâ‡∏ô‡∏á‡∏ß‡∏î‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å "‡∏á‡∏ß‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (CY)" ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏ô TB ‡∏Ñ‡∏∑‡∏≠‡∏¢‡∏≠‡∏î‡∏ï‡πâ‡∏ô‡∏õ‡∏µ | ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏á‡∏ö‡∏Å‡∏≥‡πÑ‡∏£‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô
                    <div class="mt-2 flex flex-wrap items-center gap-4">
                        <div class="flex items-center gap-2"><label class="font-bold text-green-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏∏‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏µ (‡∏ö‡∏≤‡∏ó):</label><input type="text" id="input-capital-increase" class="border p-1 rounded w-32 text-right num-input bg-green-50" placeholder="0.00" onblur="fmtInput(this);renderChangesReport();debounceSave()"></div>
                        <div class="flex items-center gap-2"><label class="font-bold text-red-700">‡∏õ‡∏±‡∏ô‡∏ú‡∏•‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó):</label><input type="text" id="input-dividend" class="border p-1 rounded w-32 text-right num-input bg-red-50" placeholder="0.00" onblur="fmtInput(this);renderChangesReport();debounceSave()"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>

   <script>
        // üîë CONFIG (Mfins)
        const firebaseConfig = {
            apiKey: "AIzaSyDGjw7KNA-eMV5qbg8ul6Xh5KiVS11Gc4E",
            authDomain: "m-finapp.firebaseapp.com",
            projectId: "m-finapp",
            storageBucket: "m-finapp.firebasestorage.app",
            messagingSenderId: "409716502526",
            appId: "1:409716502526:web:348368d14991ea51e79aaf",
            measurementId: "G-7JHLPSVVVN"
        };

        try {
            firebase.initializeApp(firebaseConfig);
            var auth = firebase.auth();
            var db = firebase.firestore();
        } catch(e) { console.error("Init Error", e); }

        let currentUser = null;

        // --- AUTH ---
        function emailLogin() {
            const e = document.getElementById('auth-email').value;
            const p = document.getElementById('auth-password').value;
            auth.signInWithEmailAndPassword(e, p).then(() => { 
                document.getElementById('loginModal').style.display='none'; 
            }).catch(err => { document.getElementById('auth-msg').innerText = "Error: " + err.message; });
        }
        function logout() { auth.signOut().then(() => { location.reload(); }); }

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                // üü¢ UNLOCK IMMEDIATELY (‡πÑ‡∏°‡πà‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î)
                document.getElementById('loginModal').style.display='none';
                document.getElementById('main-container').classList.remove('hidden');
                document.getElementById('btnLogout').classList.remove('hidden');
                document.getElementById('userEmailDisplay').innerText = user.email;
                document.getElementById('userEmailDisplay').classList.remove('hidden');
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á (Silent Load)
                loadFromCloud();
            } else {
                currentUser = null;
                document.getElementById('main-container').classList.add('hidden');
                document.getElementById('loginModal').style.display='block';
            }
        });

        // --- SILENT LOAD ---
        function loadFromCloud() {
            if(!currentUser) return;
            db.collection('users').doc(currentUser.uid).get().then(doc => {
                if (doc.exists) {
                    const d = doc.data();
                    if(d.mappings) MAPPING_CATS = JSON.parse(d.mappings);
                    if(d.appData) { restoreState(JSON.parse(d.appData)); }
                }
                // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà
                calculate(); 
                renderChangesReport();
                console.log("Cloud Data Loaded");
            }).catch(e => console.error("Load Error (Ignore if offline):", e));
        }

        // --- IMPORT LOGIC (RESTORED) ---
        function importFile(inp) {
            const f=inp.files[0]; if(!f) return;
            const r=new FileReader();
            r.onload = e => {
                const wb = XLSX.read(e.target.result, {type: f.name.endsWith('csv')?'string':'array'});
                const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {header:1});
                
                // Check existing rows
                const hasData = document.querySelectorAll('#tb-body tr').length > 0;
                let mode = 'replace';
                if(hasData) {
                    // Ask user: Replace All vs Update Numbers Only
                    if(confirm("‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß\n‡∏Å‡∏î OK = ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (Update Numbers)\n‡∏Å‡∏î Cancel = ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (Replace All)")) {
                        mode = 'update';
                    }
                }
                
                processImportRows(rows, mode); 
                inp.value = '';
            };
            if(f.name.endsWith('csv')) r.readAsText(f, document.getElementById('encodingSelect').value);
            else r.readAsArrayBuffer(f);
        }

        function processImportRows(rows, mode) {
            // If replace mode, clear table first
            if(mode === 'replace') document.getElementById('tb-body').innerHTML = '';
            
            let st=0; 
            for(let i=0; i<Math.min(rows.length, 20); i++) { 
                const str = JSON.stringify(rows[i]).toLowerCase(); 
                if(str.includes('name') || str.includes('‡∏ä‡∏∑‡πà‡∏≠')) { st=i+1; break; } 
            } 
            
            rows.slice(st).forEach(r => { 
                if(!r || r.length < 2) return; 
                let n=String(r[0]), c=0, p=0; 
                if(String(r[0]).match(/^[0-9]/) && r.length >= 4) { 
                    n=String(r[1]); 
                    const dr=parseFloat(String(r[r.length-2]).replace(/,/g,''))||0, cr=parseFloat(String(r[r.length-1]).replace(/,/g,''))||0; 
                    c=Math.abs(dr-cr); 
                } else { 
                    n=String(r[0]); 
                    c=parseFloat(String(r[1]).replace(/,/g,''))||0; 
                    p=parseFloat(String(r[2]).replace(/,/g,''))||0; 
                } 
                
                n = n.trim();
                if(n) {
                    if(mode === 'update') {
                        // Find and update existing row
                        let found = false;
                        document.querySelectorAll('#tb-body tr').forEach(tr => {
                            const rowName = tr.querySelector('.tb-name').value.trim();
                            if(rowName === n) {
                                tr.querySelector('.tb-cy').value = fmtNum(c);
                                if(p) tr.querySelector('.tb-py').value = fmtNum(p);
                                found = true;
                            }
                        });
                        if(!found) addTBRow(n,c,p); 
                    } else {
                        // Replace mode: just add
                        addTBRow(n,c,p); 
                    }
                }
            }); 
            
            saveStateToLocal(true); 
            alert(mode === 'update' ? "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢" : "‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); 
        }

        // --- CORE LOGIC ---
        var DEFAULT_MAPPINGS = [
            { id:'cat-cash', label:'‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î', group:'asset-cur', noteTitle:'‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î' },
            { id:'cat-ar', label:'‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏≠‡∏∑‡πà‡∏ô', group:'asset-cur', noteTitle:'‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏≠‡∏∑‡πà‡∏ô' },
            { id:'cat-inv', label:'‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠', group:'asset-cur', noteTitle:'‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠' },
            { id:'cat-asset-cur-other', label:'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏≠‡∏∑‡πà‡∏ô', group:'asset-cur', noteTitle:'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏≠‡∏∑‡πà‡∏ô' },
            { id:'cat-ppe', label:'‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏™‡∏∏‡∏ó‡∏ò‡∏¥)', group:'asset-non', noteTitle:'‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå' },
            { id:'cat-intangible', label:'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏ï‡∏ô', group:'asset-non', noteTitle:'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏ï‡∏ô' },
            { id:'cat-asset-non-other', label:'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏≠‡∏∑‡πà‡∏ô', group:'asset-non', noteTitle:'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏≠‡∏∑‡πà‡∏ô' },
            { id:'cat-ap', label:'‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏≠‡∏∑‡πà‡∏ô', group:'liab-cur', noteTitle:'‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏≠‡∏∑‡πà‡∏ô' },
            { id:'cat-loan-short', label:'‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô', group:'liab-cur', noteTitle:'‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô' },
            { id:'cat-tax-pay', label:'‡∏†‡∏≤‡∏©‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡πà‡∏≤‡∏¢', group:'liab-cur', noteTitle:'‡∏†‡∏≤‡∏©‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡πà‡∏≤‡∏¢' },
            { id:'cat-liab-cur-other', label:'‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏≠‡∏∑‡πà‡∏ô', group:'liab-cur', noteTitle:'‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏≠‡∏∑‡πà‡∏ô' },
            { id:'cat-loan-long', label:'‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß', group:'liab-non', noteTitle:'‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß' },
            { id:'cat-emp-benefit', label:'‡∏†‡∏≤‡∏£‡∏∞‡∏ú‡∏π‡∏Å‡∏û‡∏±‡∏ô‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', group:'liab-non', noteTitle:'‡∏†‡∏≤‡∏£‡∏∞‡∏ú‡∏π‡∏Å‡∏û‡∏±‡∏ô‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô' },
            { id:'cat-share', label:'‡∏ó‡∏∏‡∏ô‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß', group:'eq', noteTitle:'‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏´‡∏∏‡πâ‡∏ô' },
            { id:'cat-premium', label:'‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏´‡∏∏‡πâ‡∏ô', group:'eq', noteTitle:'‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏´‡∏∏‡πâ‡∏ô' },
            { id:'cat-reserve', label:'‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢', group:'eq', noteTitle:'‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢' },
            { id:'cat-re', label:'‡∏Å‡∏≥‡πÑ‡∏£(‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô) ‡∏™‡∏∞‡∏™‡∏°', group:'eq', noteTitle:'‡∏Å‡∏≥‡πÑ‡∏£(‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô) ‡∏™‡∏∞‡∏™‡∏°' },
            { id:'cat-rev-main', label:'‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', group:'rev', noteTitle:'‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£' },
            { id:'cat-rev-other', label:'‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô', group:'rev', noteTitle:'‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô' },
            { id:'cat-cog', label:'‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ç‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', group:'exp', noteTitle:'‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ç‡∏≤‡∏¢' },
            { id:'cat-exp-sell', label:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢', group:'exp', noteTitle:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢' },
            { id:'cat-exp-admin', label:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', group:'exp', noteTitle:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£' },
            { id:'cat-fin', label:'‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', group:'fin', noteTitle:'‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô' },
            { id:'cat-tax', label:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ', group:'tax', noteTitle:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ' }
        ];
        var MAPPING_CATS = [...DEFAULT_MAPPINGS];
        var myBarChart=null, myPieChart=null, saveTimeout;

        document.addEventListener('DOMContentLoaded', () => { loadMappings(); updateYears(); initFSRows(); for(let i=0;i<3;i++) addTBRow(); addTaxRow('tax-add-body','tax-add-item','‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô'); addTaxRow('tax-deduct-body','tax-deduct-item','‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (2 ‡πÄ‡∏ó‡πà‡∏≤)'); calculate(); const pd = document.getElementById('print-date'); if(pd) pd.innerText = new Date().toLocaleDateString('th-TH'); document.querySelectorAll('input.num-input, input[type="number"]').forEach(input => { input.addEventListener('blur', function() { let val = parseFloat(this.value.replace(/,/g, '')); if (!isNaN(val)) { this.value = val.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}); } }); input.addEventListener('focus', function() { let val = this.value.replace(/,/g, ''); if(!isNaN(parseFloat(val))) this.value = val; }); }); });
        function fmtNum(n) { if (typeof n === 'string') n = n.replace(/,/g, ''); let val = parseFloat(n); return isNaN(val) ? "0.00" : val.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}); }
        function safeSetText(id, val) { const el=document.getElementById(id); if(el) el.innerText = val; }
        function safeGetVal(id) { const el=document.getElementById(id); return el ? parseFloat(el.innerText.replace(/,/g,''))||0 : 0; }
        function debounceSave() { clearTimeout(saveTimeout); saveTimeout = setTimeout(() => saveStateToLocal(false), 1000); }
        function fmtInput(el) { let v=parseFloat(el.value.replace(/,/g, '')); if(!isNaN(v)) el.value=v.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}); debounceSave(); }
        function updateYears() { const y1=document.getElementById('year-cur-input').value, y2=document.getElementById('year-prev-input').value; document.querySelectorAll('.header-year-cur').forEach(e=>e.innerText=y1); document.querySelectorAll('.header-year-prev').forEach(e=>e.innerText=y2); }
        function switchTab(t) { ['tb','fs','notes','tax','dashboard','changes'].forEach(x => { document.getElementById('tab-content-'+x).style.display = 'none'; const btn = document.getElementById('tab-btn-'+x); if(btn) btn.className = "tab-btn flex-1 py-3 px-2 text-center tab-inactive"; }); document.getElementById('tab-content-'+t).style.display = 'block'; const btn = document.getElementById('tab-btn-'+t); if(btn) { btn.className = "tab-btn flex-1 py-3 px-2 text-center tab-active"; if(t==='tax') btn.classList.add('bg-green-100','text-green-800'); if(t==='dashboard') btn.classList.add('bg-purple-100','text-purple-800'); if(t==='changes') btn.classList.add('bg-indigo-100','text-indigo-800'); } document.body.className = "bg-gray-100 min-h-screen py-8 text-gray-800"; if(t === 'fs') { document.body.classList.add('print-fs'); processTBtoFS(); } if(t === 'dashboard') { document.body.classList.add('print-dashboard'); calculate(); renderDashboard(); } if(t==='changes') { document.body.classList.add('print-change'); calculate(); renderChangesReport(); } if(t==='tax') { calculate(); const ebt = safeGetVal('ebt-cy'); safeSetText('tax-accounting-profit', fmtNum(ebt)); calculateTax(); } }
        function closeSettingsModal() { document.getElementById('settingsModal').style.display='none'; }
        function addTBRow(n="",c="",p="",m="") { const tr=document.createElement('tr'); let o=`<option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å--</option>`; MAPPING_CATS.forEach(cat=>{ let selected = (m && cat.id === m) ? 'selected' : ''; if(!selected && !m && n && cat.label === n) selected = 'selected'; o+=`<option value="${cat.id}" ${selected}>${cat.label}</option>`; }); tr.innerHTML=`<td class="p-2"><input type="text" value="${n}" class="w-full p-2 border rounded tb-name" oninput="debounceSave()"></td><td class="p-2"><select class="w-full p-2 border rounded tb-map text-sm" onchange="debounceSave()">${o}</select></td><td class="p-2"><input type="text" value="${c?fmtNum(c):''}" onblur="fmtInput(this)" onfocus="this.value=this.value.replace(/,/g,'')" class="w-full p-2 border rounded text-right tb-cy num-input"></td><td class="p-2"><input type="text" value="${p?fmtNum(p):''}" onblur="fmtInput(this)" onfocus="this.value=this.value.replace(/,/g,'')" class="w-full p-2 border rounded text-right tb-py num-input"></td><td class="p-2 text-center"><button onclick="this.closest('tr').remove();calculate();debounceSave()" class="text-red-500 font-bold">√ó</button></td>`; document.getElementById('tb-body').appendChild(tr); }
        function initFSRows() { ['asset-cur','asset-non','liab-cur','liab-non','eq','rev','exp','fin','tax'].forEach(g => { const el = document.getElementById(`group-${g}`); if(el) el.innerHTML = ''; }); MAPPING_CATS.forEach(m => { const tbody = document.getElementById(`group-${m.group}`); if(tbody) addFSRow(`group-${m.group}`, m.group, m.label, '', '', m.id); }); }
        function addFSRow(tid,grp,n="",c="",p="",mid="",note="") { const tr=document.createElement('tr'); tr.setAttribute('data-map-id',mid); tr.innerHTML=`<td class="p-1 pl-10 border-b border-gray-100"><input type="text" value="${n}" list="std-accounts" oninput="debounceSave()" class="w-full bg-transparent focus:outline-none border-b border-transparent focus:border-blue-400"></td><td class="p-1 text-center"><input type="text" value="${note}" oninput="debounceSave()" class="w-8 text-center text-xs p-1 border-none focus:ring-1" placeholder="-"></td><td class="p-1"><input type="text" value="${c?fmtNum(c):''}" onblur="fmtInput(this)" onfocus="this.value=this.value.replace(/,/g,'')" class="w-full p-1 border rounded text-right num-input fs-cy" data-group="${grp}-cy" oninput="calculate()"></td><td class="p-1"><input type="text" value="${p?fmtNum(p):''}" onblur="fmtInput(this)" onfocus="this.value=this.value.replace(/,/g,'')" class="w-full p-1 border rounded text-right num-input fs-py" data-group="${grp}-py" oninput="calculate()"></td><td class="p-1 text-center no-print"><button onclick="this.closest('tr').remove();calculate();debounceSave()" class="text-red-400 font-bold">√ó</button></td>`; const el = document.getElementById(tid); if(el) el.appendChild(tr); }
        function processTBtoFS() { document.querySelectorAll('tr[data-map-id] input.fs-cy').forEach(e=>e.value=''); document.querySelectorAll('tr[data-map-id] input.fs-py').forEach(e=>e.value=''); const agg={}, notes={}; document.querySelectorAll('#tb-body tr').forEach(r=>{ const n=r.querySelector('.tb-name').value, m=r.querySelector('.tb-map').value; const c=parseFloat(r.querySelector('.tb-cy').value.replace(/,/g,''))||0, p=parseFloat(r.querySelector('.tb-py').value.replace(/,/g,''))||0; if(m && n) { if(!agg[m]) agg[m]={cy:0,py:0}; agg[m].cy+=c; agg[m].py+=p; if(Math.abs(c)>0.001||Math.abs(p)>0.001) { if(!notes[m]) notes[m]=[]; notes[m].push({n,c,p}); } } }); for(const [id,v] of Object.entries(agg)) { const r=document.querySelector(`tr[data-map-id="${id}"]`); if(r) { const m=MAPPING_CATS.find(x=>x.id===id); let f=1; if(m && ['liab-cur','liab-non','eq','rev'].some(g=>m.group.startsWith(g)||m.group===g)) f=-1; r.querySelector('.fs-cy').value=fmtNum(v.cy*f); r.querySelector('.fs-py').value=fmtNum(v.py*f); } } const cnt=document.getElementById('dynamic-notes-container'); if(cnt) { cnt.innerHTML=''; let nn=3; MAPPING_CATS.forEach(m => { const id = m.id; const d = notes[id]; if(d && d.length) { let f=1; if(['liab-cur','liab-non','eq','rev'].some(g=>m.group.startsWith(g)||m.group===g)) f=-1; let tC=0, tP=0, h=''; d.forEach(i=>{ const vc=i.c*f, vp=i.p*f; tC+=vc; tP+=vp; h+=`<tr><td class="py-1 border-b pl-2">${i.n}</td><td class="py-1 border-b text-right font-mono">${fmtNum(vc)}</td><td class="py-1 border-b text-right font-mono">${fmtNum(vp)}</td></tr>`; }); cnt.insertAdjacentHTML('beforeend', `<div class="bg-white p-6 border rounded shadow-sm break-inside-avoid"><h3 class="font-bold text-lg mb-3">${nn}. ${m.noteTitle}</h3><table class="w-full text-sm"><thead><tr class="bg-gray-50 border-b-2"><th class="text-left w-1/2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th class="text-right w-1/4">${document.getElementById('year-cur-input').value}</th><th class="text-right w-1/4">${document.getElementById('year-prev-input').value}</th></tr></thead><tbody>${h}</tbody><tfoot><tr class="font-bold border-t-2"><td class="text-right pr-4">‡∏£‡∏ß‡∏°</td><td class="text-right border-b-4 border-double">${fmtNum(tC)}</td><td class="text-right border-b-4 border-double">${fmtNum(tP)}</td></tr></tfoot></table></div>`); nn++; } }); } calculate(); debounceSave(); }
        function calculate() { try { const val = el => parseFloat(el.value.replace(/,/g,''))||0; const sum = s => { let t=0; document.querySelectorAll(`input[data-group$="${s}"]`).forEach(i => t+=val(i)); return t; }; ['cy','py'].forEach(y => { const rev = sum(`rev-${y}`), exp = sum(`exp-${y}`), fin = sum(`fin-${y}`), tax = sum(`tax-${y}`); safeSetText(`total-rev-${y}`, fmtNum(rev)); safeSetText(`total-exp-${y}`, fmtNum(exp)); safeSetText(`ebit-${y}`, fmtNum(rev-exp)); safeSetText(`ebt-${y}`, fmtNum(rev-exp-fin)); const netProfit = rev-exp-fin-tax; safeSetText(`net-profit-${y}`, fmtNum(netProfit)); safeSetText(`bs-auto-profit-${y}`, fmtNum(netProfit)); const ac = sum(`asset-cur-${y}`), an = sum(`asset-non-${y}`), lc = sum(`liab-cur-${y}`), ln = sum(`liab-non-${y}`); const e_input = sum(`eq-${y}`); const e_total = e_input + netProfit; const ta = ac+an, tl=lc+ln, tle=tl+e_total; safeSetText(`total-asset-cur-${y}`, fmtNum(ac)); safeSetText(`total-asset-non-${y}`, fmtNum(an)); safeSetText(`grand-total-asset-${y}`, fmtNum(ta)); safeSetText(`total-liab-cur-${y}`, fmtNum(lc)); safeSetText(`total-liab-non-${y}`, fmtNum(ln)); safeSetText(`grand-total-liab-${y}`, fmtNum(tl)); safeSetText(`total-eq-${y}`, fmtNum(e_total)); safeSetText(`grand-total-le-${y}`, fmtNum(tle)); const shares = parseFloat(document.getElementById('share-count').value.replace(/,/g,''))||0; if(shares > 0) safeSetText(`eps-${y}`, fmtNum(netProfit/shares)); if(y==='cy') { const msg = document.getElementById('balance-msg'), row = document.getElementById('balance-check-row'); if(msg && row) { row.classList.remove('hidden'); if(Math.abs(ta - tle) < 0.01) { msg.className = "p-2 rounded bg-green-500"; msg.innerText = "‚úì ‡∏á‡∏ö‡∏î‡∏∏‡∏•‡∏•‡∏á‡∏ï‡∏±‡∏ß"; } else { msg.className = "p-2 rounded bg-red-500"; msg.innerText = `‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏•‡∏á‡∏ï‡∏±‡∏ß (‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á: ${fmtNum(ta-tle)})`; } } } }); } catch(e) { console.error(e); } }
        
        // --- UPDATED LOGIC: Use CY for Beginning Balance in Changes Report + Capital Increase ---
        function renderChangesReport() { 
            const table = document.getElementById('changes-body'); table.innerHTML = ''; 
            
            // Beginning Balance (From CY TB)
            const getValFromMap = (mapId) => { 
                let v = 0; 
                document.querySelectorAll(`tr[data-map-id="${mapId}"] input[data-group="eq-cy"]`).forEach(i => v += parseFloat(i.value.replace(/,/g,''))||0); 
                return v; 
            }; 
            const begShare = getValFromMap('cat-share'); 
            const begPremium = getValFromMap('cat-premium'); 
            const begReserve = getValFromMap('cat-reserve'); 
            const begRE = getValFromMap('cat-re'); 
            const begTotal = begShare + begPremium + begReserve + begRE; 
            
            // Adjustments
            const netProfit = parseFloat(document.getElementById('net-profit-cy').innerText.replace(/,/g,''))||0; 
            const dividend = parseFloat(document.getElementById('input-dividend').value.replace(/,/g,''))||0; 
            const capInc = parseFloat(document.getElementById('input-capital-increase').value.replace(/,/g,''))||0; 
            
            // Ending Balance
            const endShare = begShare + capInc; // Capital Increase adds here
            const endPremium = begPremium; 
            const endReserve = begReserve; 
            const endRE = begRE + netProfit - dividend; 
            const endTotal = endShare + endPremium + endReserve + endRE; 
            
            const row = (label, c1, c2, c3, c4, c5, css='') => `<tr class="${css}"><td class="p-3 border-b border-r">${label}</td><td class="p-3 border-b text-right">${fmtNum(c1)}</td><td class="p-3 border-b text-right">${fmtNum(c2)}</td><td class="p-3 border-b text-right">${fmtNum(c3)}</td><td class="p-3 border-b text-right">${fmtNum(c4)}</td><td class="p-3 border-b text-right font-bold bg-gray-100">${fmtNum(c5)}</td></tr>`; 
            
            let html = row('‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ï‡πâ‡∏ô‡∏á‡∏ß‡∏î (‡∏ï‡∏≤‡∏°‡∏á‡∏ö‡∏ó‡∏î‡∏•‡∏≠‡∏á)', begShare, begPremium, begReserve, begRE, begTotal); 
            
            // Insert Capital Increase Row if value > 0
            if(capInc > 0) {
                html += row('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏∏‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏µ', capInc, 0, 0, 0, capInc, 'text-blue-600');
            }

            html += row('‡∏ö‡∏ß‡∏Å: ‡∏Å‡∏≥‡πÑ‡∏£(‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô)‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏á‡∏ß‡∏î', 0, 0, 0, netProfit, netProfit, 'text-green-600'); 
            html += row('‡∏´‡∏±‡∏Å: ‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏ô‡∏ú‡∏•‡∏à‡πà‡∏≤‡∏¢', 0, 0, 0, -dividend, -dividend, 'text-red-600'); 
            html += row('‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏•‡∏≤‡∏¢‡∏á‡∏ß‡∏î', endShare, endPremium, endReserve, endRE, endTotal, 'font-bold bg-indigo-50 border-t-2 border-indigo-300'); 
            
            table.innerHTML = html; 
        }

        function calculateTax() { const acct = safeGetVal('tax-accounting-profit'); let add=0; document.querySelectorAll('.tax-add-item').forEach(i=>add+=parseFloat(i.value.replace(/,/g,''))||0); let ded=0; document.querySelectorAll('.tax-deduct-item').forEach(i=>ded+=parseFloat(i.value.replace(/,/g,''))||0); let net = acct + add - ded; safeSetText('tax-net-profit', fmtNum(net)); let tax = 0; if(net > 0) { const type = document.querySelector('input[name="tax-type"]:checked')?.value || 'sme'; if(type === 'sme') { if(net > 300000) tax += Math.min(net-300000, 2700000) * 0.15; if(net > 3000000) tax += (net-3000000) * 0.20; } else { tax = net * 0.20; } } safeSetText('tax-payable-total', fmtNum(tax)); }
        function addTaxRow(id, cls, n="", v="") { const tr = document.createElement('tr'); let listAttr = cls.includes('add') ? 'list="tax-add-list"' : 'list="tax-deduct-list"'; tr.innerHTML = `<td class="p-2 pl-8"><input type="text" class="w-full bg-transparent border-b" ${listAttr} value="${n}" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..." oninput="debounceSave()"></td><td class="p-2 flex items-center"><input type="text" value="${v?fmtNum(v):'0.00'}" onblur="fmtInput(this)" onfocus="this.value=this.value.replace(/,/g,'')" class="w-full text-right border rounded p-1 ${cls} num-input" onchange="calculateTax()"><button onclick="this.closest('tr').remove();calculateTax();debounceSave()" class="text-red-500 ml-2 no-print font-bold">√ó</button></td>`; document.getElementById(id).appendChild(tr); }
        function applyTaxToFS() { const t = parseFloat(document.getElementById('tax-payable-total').innerText.replace(/,/g,'')); const inputs = document.querySelectorAll('#group-tax input.fs-cy'); if(inputs.length) { inputs[0].value = fmtNum(t); calculate(); debounceSave(); switchTab('fs'); } else alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏µ‡πÉ‡∏ô‡∏á‡∏ö‡∏Å‡πà‡∏≠‡∏ô'); }
        function downloadTemplate() { const wb=XLSX.utils.book_new(), ws=XLSX.utils.aoa_to_sheet([["‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ","‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô","‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ô"],["‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î",50000,45000]]); XLSX.utils.book_append_sheet(wb,ws,"Template"); XLSX.utils.writeFile(wb,"Template.xlsx"); }
        function clearForm() { if(confirm('Clear?')) { localStorage.removeItem('fs_app_state'); location.reload(); } }
        function hardReset() { if(confirm('‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏≤‡∏ß‡∏£')) { localStorage.removeItem('fs_app_state'); localStorage.removeItem('fs_custom_mappings'); location.reload(); } }
        function getAppStateFromDOM() {
             const st = { company: { name:document.getElementById('company-name').value, id:document.getElementById('company-id').value, date:document.getElementById('closing-date').value, y1:document.getElementById('year-cur-input').value, y2:document.getElementById('year-prev-input').value }, share: document.getElementById('share-count').value.replace(/,/g, ''), tb: [], fs: [], notes: { n1:document.getElementById('note-1-text').value, n2:document.getElementById('note-2-text').value }, tax: { add:[], deduct:[], type:document.querySelector('input[name="tax-type"]:checked')?.value||'sme' }, dividend: document.getElementById('input-dividend').value.replace(/,/g,''), capitalIncrease: document.getElementById('input-capital-increase').value.replace(/,/g,'') }; // Save Capital Increase
            document.querySelectorAll('#tb-body tr').forEach(r=>{ st.tb.push({ n:r.querySelector('.tb-name').value, m: r.querySelector('.tb-map').value, c:r.querySelector('.tb-cy').value.replace(/,/g, ''), p:r.querySelector('.tb-py').value.replace(/,/g, '') }); });
            document.getElementById('tax-add-body').querySelectorAll('tr').forEach(row => { const inputs = row.querySelectorAll('input'); if(inputs.length >= 2) st.tax.add.push({n: inputs[0].value, v: inputs[1].value.replace(/,/g, '')}); });
            document.getElementById('tax-deduct-body').querySelectorAll('tr').forEach(row => { const inputs = row.querySelectorAll('input'); if(inputs.length >= 2) st.tax.deduct.push({n: inputs[0].value, v: inputs[1].value.replace(/,/g, '')}); });
            return st;
        }
        function saveStateToLocal(force = false) {
            try { 
                const st = getAppStateFromDOM(); localStorage.setItem('fs_app_state', JSON.stringify(st));
                const s=document.getElementById('auto-save-status'); if(s){ s.style.opacity='1'; setTimeout(()=>s.style.opacity='0',2000); }
                if (currentUser) { db.collection('users').doc(currentUser.uid).set({ updatedAt: firebase.firestore.FieldValue.serverTimestamp(), appData: JSON.stringify(st), mappings: JSON.stringify(MAPPING_CATS) }, { merge: true }); }
                if(force) alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            } catch(e) {}
        }
        function loadStateFromLocal() { const s=localStorage.getItem('fs_app_state'); if(!s) return false; try{ restoreState(JSON.parse(s)); return true; }catch(e){return false;} }
        function saveBackupFile() { const appData = getAppStateFromDOM(); const b = new Blob([JSON.stringify({version: "2.1", timestamp: new Date().toISOString(), appData: appData, customMap: MAPPING_CATS})], {type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = `Backup_${appData.company.name || 'Financial'}.json`; a.click(); }
        function loadBackupFile(i) { const f=i.files[0]; if(!f)return; const r=new FileReader(); r.onload = e => { try { const d = JSON.parse(e.target.result); if(d.customMap) { MAPPING_CATS = d.customMap; saveMappings(); } initFSRows(); restoreState(d.appData || d); saveStateToLocal(true); alert('‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'); } catch(x) { alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); } }; r.readAsText(f); i.value=''; }
        function restoreState(s) {
            if(s.company) { document.getElementById('company-name').value=s.company.name; document.getElementById('company-id').value=s.company.id; document.getElementById('closing-date').value=s.company.date; document.getElementById('year-cur-input').value=s.company.y1; document.getElementById('year-prev-input').value=s.company.y2; updateYears(); }
            if(s.share) document.getElementById('share-count').value = fmtNum(s.share);
            if(s.dividend) document.getElementById('input-dividend').value = fmtNum(s.dividend);
            if(s.capitalIncrease) document.getElementById('input-capital-increase').value = fmtNum(s.capitalIncrease); // Restore Capital Increase
            document.getElementById('tb-body').innerHTML=''; if(s.tb && s.tb.length) s.tb.forEach(r => addTBRow(r.n, r.c, r.p, r.m)); else for(let i=0;i<3;i++) addTBRow();
            initFSRows(); processTBtoFS();
            if(s.notes) { document.getElementById('note-1-text').value=s.notes.n1; document.getElementById('note-2-text').value=s.notes.n2; }
            const taxType = s.tax ? s.tax.type : 'sme'; const rad = document.querySelector(`input[name="tax-type"][value="${taxType}"]`); if(rad) rad.checked=true;
            document.getElementById('tax-add-body').innerHTML=''; if(s.tax && s.tax.add && s.tax.add.length) s.tax.add.forEach(i=>addTaxRow('tax-add-body','tax-add-item',i.n,i.v)); else addTaxRow('tax-add-body','tax-add-item','‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô');
            document.getElementById('tax-deduct-body').innerHTML=''; if(s.tax && s.tax.deduct && s.tax.deduct.length) s.tax.deduct.forEach(i=>addTaxRow('tax-deduct-body','tax-deduct-item',i.n,i.v)); else addTaxRow('tax-deduct-body','tax-deduct-item','‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (2 ‡πÄ‡∏ó‡πà‡∏≤)');
            processTBtoFS(); renderChangesReport(); 
        }
        function importFSUpdate(inp) { const f=inp.files[0]; if(!f) return; const r=new FileReader(); r.onload = e => { const wb = XLSX.read(e.target.result, {type:f.name.endsWith('csv')?'string':'array'}); const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {header:1}); updateFSRows(rows); inp.value=''; }; if(f.name.endsWith('csv')) r.readAsText(f, document.getElementById('fs-encoding').value); else r.readAsArrayBuffer(f); }
        function updateFSRows(rows) { let st=0, colName=0, colCY=2, colPY=3; for(let i=0;i<Math.min(rows.length,20);i++){ if(JSON.stringify(rows[i]).includes('‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£')){ st=i+1; rows[i].forEach((c,idx)=>{if(String(c).includes('‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'))colName=idx;if(String(c).includes('‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏')){colCY=idx+1;colPY=idx+2;}}); break;}} let cnt=0; rows.slice(st).forEach(r=>{ const name=String(r[colName]||'').trim(); if(name){ document.querySelectorAll('input[list="std-accounts"]').forEach(inp=>{ if(inp.value.trim()===name){ const row=inp.closest('tr'); if(row.querySelector('.fs-cy')){ row.querySelector('.fs-cy').value=fmtNum(r[colCY]); row.querySelector('.fs-py').value=fmtNum(r[colPY]); cnt++; } } }); } }); saveStateToLocal(true); alert(`Updated ${cnt} items`); calculate(); }
        function loadMappings() { const s=localStorage.getItem('fs_custom_mappings'); if(s) try{MAPPING_CATS=JSON.parse(s);}catch(e){} }
        function saveMappings() { localStorage.setItem('fs_custom_mappings', JSON.stringify(MAPPING_CATS)); }
        function openSettingsModal() { const tbody = document.getElementById('mapping-settings-body'); tbody.innerHTML=''; MAPPING_CATS.forEach((m,i)=>{ const tr = document.createElement('tr'); tr.innerHTML=`<td class="p-2 border"><input type="text" value="${m.label}" class="w-full border p-1 rounded" onchange="MAPPING_CATS[${i}].label=this.value;MAPPING_CATS[${i}].noteTitle=this.value"></td><td class="p-2 border"><select class="w-full border p-1 rounded" onchange="MAPPING_CATS[${i}].group=this.value">${['asset-cur','asset-non','liab-cur','liab-non','eq','rev','exp','fin','tax'].map(v=>`<option value="${v}" ${m.group===v?'selected':''}>${v}</option>`).join('')}</select></td><td class="p-2 border text-center"><button onclick="MAPPING_CATS.splice(${i},1);saveMappings();openSettingsModal()" class="text-red-500 font-bold">√ó</button></td>`; tbody.appendChild(tr); }); document.getElementById('settingsModal').style.display='block'; }
        function addNewMapping() { const l=document.getElementById('new-map-label').value.trim(), g=document.getElementById('new-map-group').value; if(!l) return; MAPPING_CATS.push({id:'c-'+Date.now(), label:l, group:g, noteTitle:l}); saveMappings(); openSettingsModal(); }
        function resetMappingsToDefault() { if(confirm('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï?')) { MAPPING_CATS=JSON.parse(JSON.stringify(DEFAULT_MAPPINGS)); openSettingsModal(); } }
        function saveMappingsAndClose() { saveMappings(); document.getElementById('settingsModal').style.display='none'; initFSRows(); renderTBMappingOptions(); }
        function renderTBMappingOptions() { document.querySelectorAll('.tb-map').forEach(s => { const v=s.value; s.innerHTML=`<option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å--</option>`+MAPPING_CATS.map(c=>`<option value="${c.id}">${c.label}</option>`).join(''); s.value=v; }); }
        function exportReportToExcel() {
            saveStateToLocal(true); const wb = XLSX.utils.book_new(); const companyName = document.getElementById('company-name').value || 'Financial_Report';
            const beautifySheet = (ws) => { ws['!cols'] = [{wch:50},{wch:15},{wch:20},{wch:20},{wch:10}]; const range = XLSX.utils.decode_range(ws['!ref']); for(let R=range.s.r;R<=range.e.r;++R){ for(let C=range.s.c;C<=range.e.c;++C){ const cell=ws[XLSX.utils.encode_cell({r:R,c:C})]; if(!cell) continue; cell.s={font:{name:"Arial",sz:11},alignment:{vertical:"center",wrapText:true},border:{top:{style:"thin",color:{rgb:"E0E0E0"}},bottom:{style:"thin",color:{rgb:"E0E0E0"}}}}; if(cell.t==='n'){ cell.z="#,##0.00"; cell.s.alignment.horizontal="right"; } if(R<2||(cell.v&&String(cell.v).includes("‡∏£‡∏ß‡∏°"))){ cell.s.font.bold=true; cell.s.fill={fgColor:{rgb:"F3F4F6"}}; } if(cell.v&&(String(cell.v)==="‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå"||String(cell.v)==="‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô")){ cell.s.font.bold=true; cell.s.font.color={rgb:"1E40AF"}; } } } };
            const getTbl=(id)=>{ const t=document.getElementById(id); if(!t)return[]; const rows=[]; if(t.querySelector('thead')) { const h=[]; t.querySelectorAll('thead th').forEach(x=>h.push(x.innerText)); rows.push(h); } t.querySelectorAll('tbody tr, tfoot tr').forEach(tr=>{ if(tr.style.display!=='none'&&!tr.classList.contains('hidden')){ const r=[]; tr.querySelectorAll('td').forEach(td=>{ const inp=td.querySelector('input'), sel=td.querySelector('select'); if(inp){ if(inp.type==='number'||inp.classList.contains('num-input')) r.push(parseFloat(inp.value.replace(/,/g,''))||0); else r.push(inp.value); } else if(sel) r.push(sel.options[sel.selectedIndex].text); else r.push(td.textContent.trim()); if(td.id && td.id.includes('bs-auto-profit')) r.push(parseFloat(td.innerText.replace(/,/g,''))||0); }); if(r.length) rows.push(r); } }); return rows; };
            const fsData=[[companyName],["‡∏á‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ê‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô"],[]]; getTbl('bs-table').forEach(r=>fsData.push(r)); fsData.push([],["‡∏á‡∏ö‡∏Å‡∏≥‡πÑ‡∏£‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô"]); getTbl('pl-table').forEach(r=>fsData.push(r)); const wsFS=XLSX.utils.aoa_to_sheet(fsData); beautifySheet(wsFS); XLSX.utils.book_append_sheet(wb, wsFS, "‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô");
            const notesData=[[companyName],["‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô"],[],["1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ"],[document.getElementById('note-1-text').value],[],["2. ‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ"],[document.getElementById('note-2-text').value],[]];
            document.querySelectorAll('#dynamic-notes-container .bg-white').forEach(div=>{ const h=div.querySelector('h3'); if(h) notesData.push([h.innerText]); const t=div.querySelector('table'); if(t){ t.querySelectorAll('tr').forEach(tr=>{ const r=[]; tr.querySelectorAll('th, td').forEach((td,i)=>{ if(i>0) r.push(parseFloat(td.innerText.replace(/,/g,''))||0); else r.push(td.innerText); }); notesData.push(r); }); notesData.push([]); } });
            const wsNotes=XLSX.utils.aoa_to_sheet(notesData); beautifySheet(wsNotes); XLSX.utils.book_append_sheet(wb, wsNotes, "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏");
            const taxData=[["‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏©‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ô‡∏¥‡∏ï‡∏¥‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (‡∏†.‡∏á.‡∏î. 50)"],[]]; getTbl('tax-table').forEach(r=>taxData.push(r)); const wsTax=XLSX.utils.aoa_to_sheet(taxData); beautifySheet(wsTax); XLSX.utils.book_append_sheet(wb, wsTax, "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏©‡∏µ");
            
            // Export Changes Report
            const changeData = [[companyName],["‡∏á‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô"],[]]; getTbl('changes-table').forEach(r=>changeData.push(r)); const wsChange=XLSX.utils.aoa_to_sheet(changeData); beautifySheet(wsChange); XLSX.utils.book_append_sheet(wb, wsChange, "‡∏á‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏∏‡∏ô");

            XLSX.writeFile(wb, `${companyName}_‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô.xlsx`);
        }
        function renderDashboard() {
            const getVal = id => safeGetVal(id);
            const revCY=getVal('total-rev-cy'), netCY=getVal('net-profit-cy');
            document.getElementById('dash-rev').innerText = fmtNum(revCY); document.getElementById('dash-profit').innerText = fmtNum(netCY);
            document.getElementById('dash-margin').innerText = (revCY ? (netCY/revCY)*100 : 0).toFixed(2)+'%';
            let cash=0; document.querySelectorAll('tr[data-map-id="cat-cash"] input.fs-cy').forEach(i=>cash+=parseFloat(i.value.replace(/,/g,''))||0); document.getElementById('dash-cash').innerText = fmtNum(cash);
            const ctxBar = document.getElementById('barChart'); if(ctxBar) { if(window.myBarChart) window.myBarChart.destroy(); window.myBarChart = new Chart(ctxBar, { type:'bar', data: { labels:['‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ','‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢','‡∏Å‡∏≥‡πÑ‡∏£'], datasets:[{label:'CY',data:[revCY, getVal('total-exp-cy'), netCY],backgroundColor:'#3b82f6'}] }, options:{responsive:true,maintainAspectRatio:false} }); }
            const ctxPie = document.getElementById('pieChart'); if(ctxPie) { if(window.myPieChart) window.myPieChart.destroy(); let cCog=0; document.querySelectorAll('#group-exp input.fs-cy').forEach(i=> cCog += parseFloat(i.value.replace(/,/g,''))||0); window.myPieChart = new Chart(ctxPie, { type:'doughnut', data:{labels:['‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°'],datasets:[{data:[cCog],backgroundColor:['#f59e0b']}]}, options:{responsive:true,maintainAspectRatio:false} }); }
        }
   </script>
</body>
</html>